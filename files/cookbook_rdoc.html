<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>cookbook.rdoc</title>
    <meta content='text/html; charset=IBM437' http-equiv='Content-Type'>
    <link href='../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <div class='name'>cookbook.rdoc</div>
        <div class='paths'>
          cookbook.rdoc
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>2011-08-28 19:15:03 -0600</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <h1>Getting Started With FreeImage</h1>
            
            <p>Below are various recipes to get you up and running with FreeImage as
            quickly as possible.  Note that the images the recipes use can be found in
            the test/images directory.  For more general information about FreeImage,
            including installation instructions, please refer to <a
            href="README_rdoc.html">README.rdoc</a>.</p>
            
            <h2>Loading An Image</h2>
            
            <p>The first step in using FreeImage is to load an image.  FreeImage can load
            images from files, strings or IO streams.  The simplest way to do this is
            via the <a
            href="../classes/FreeImage/Bitmap.html#method-c-open">FreeImage::Bitmap.open</a>
            method:</p>
            
            <pre>image = FreeImage::Bitmap.open('images/lena.tiff')&#x000A;image = FreeImage::Bitmap.open(io_object)&#x000A;image = FreeImage::Bitmap.open(FreeImage::Memory.new(string))</pre>
            
            <p>The open method also takes two additional optional parameters, format and
            flags, that provide greater control over opening images if needed.</p>
            
            <p><img src="../cookbook/lena.png" /></p>
            
            <h2>Saving An Image</h2>
            
            <p>Now let's say you want to save the image to :png format.  This is done via
            the <a
            href="../classes/FreeImage/Bitmap.html#method-i-save">FreeImage::Bitmap.save</a>
            method.  The save method takes a destination, which can be a files, strings
            or IO stream, and an image format.</p>
            
            <pre>image.save('images/lena.png', :png)</pre>
            
            <h2>Creating a Thumbnail</h2>
            
            <p>Next, let's assume our application needs to show a list of thumbnails for
            the images it stores.  This can be done using the <a
            href="../classes/FreeImage/Modify.html#method-i-make_thumbnail">make_thumbnail</a>
            method in the <a href="../classes/FreeImage/Modify.html">Modify</a> module.</p>
            
            <pre>thumbnail = image.make_thumbnail(100)&#x000A;thumbnail.save('images/lena_thumbnail.png', :png)</pre>
            
            <p><img src="../cookbook/lena_thumbnail.png" /></p>
            
            <h2>Putting a Border Around a Thumbnail</h2>
            
            <p>Next, let's assume we want to put a red border around our thumbnail.  There
            are various approaches to do doing this.  In the first approach, we'll use
            the <a href="../classes/FreeImage/Modify.html#method-i-enlarge_canvas"><a
            href="FreeImage::Modify.enlarge_canvas">enlarge_canvas</a></a> method.</p>
            
            <pre># Border size&#x000A;border = 4&#x000A;# Specify the red color&#x000A;color = FreeImage::RGBQuad.create(255, 0, 0)&#x000A;&#x000A;# Add 4 pixel red border around the thumbnail&#x000A;thumbnail_border = thumbnail.enlarge_canvas(border, border, border, border, color)&#x000A;thumbnail_border.save('images/lena_thumbnail_border_1.png', :png)</pre>
            
            <p><img src="../cookbook/lena_thumbnail_border_enlarge.png" /></p>
            
            <p>In the second approach, let's create a image with a red background and then
            paste ontop of it our thumbnail:</p>
            
            <pre># Create a red image that is the same size as the thumbnail&#x000A;red_image = FreeImage::Bitmap.create(thumbnail.width, thumbnail.height, thumbnail.bits_per_pixel)&#x000A;red_image_new.fill_background(color)&#x000A;# Now copy a subimage from the thumbnail that is 2 borders less wide and tall&#x000A;subimage = thumbnail.copy(border, border, thumbnail.width - border, thumbnail.height - border)&#x000A;&#x000A;# Now paste the submimage into the red image.  Specify an alpha over 255&#x000A;# to disable alpha blending&#x000A;red_image.paste(subimage, border, border, 300)&#x000A;red_image.save('images/test1.png', :png)&#x000A;thumbnail_border.save('images/lena_thumbnail_border_2.png', :png)</pre>
            
            <p><img src="../cookbook/lena_thumbnail_border_paste.png" /></p>
            
            <h2>Resampling An Image</h2>
            
            <p>If you need additional control of how an image is resampled, then use the
            <a
            href="../classes/FreeImage/Modify.html#method-i-rescale">FreeImage::Bitmap#rescale</a>
            method, which lets you specify a filtering algorithm.  To see how each
            filter works, let's scale up the thumbnail by 400%.</p>
            
            <pre>thumbnail = FreeImage::Bitmap.open('images/lena_thumbnail.png')&#x000A;FreeImage.enum_type(:filter).symbols.each do |filter|&#x000A;  rescaled = thumbnail.rescale(thumbnail.width * 4, thumbnail.height * 4, filter)&#x000A;  rescaled.save(&quot;images/lena_rescale_#{filter.to_s}.png&quot;, :png)&#x000A;end</pre>
            
            <p><img src="../cookbook/lena_rescale_box.png" /> <img
            src="../cookbook/lena_rescale_bicubic.png" /> <img
            src="../cookbook/lena_rescale_bilinear.png" /> <img
            src="../cookbook/lena_rescale_bspline.png" /> <img
            src="../cookbook/lena_rescale_catmullrom.png" /> <img
            src="../cookbook/lena_rescale_lanczos3.png" /></p>
            
            <h2>Flipping An Image</h2>
            
            <p>The Transform modules lets you flip or rotate an image. Let's say you want
            to flip and image horizontally:</p>
            
            <pre>image.flip_horizontal&#x000A;image.save('images/lena_flipped.png', :png)</pre>
            
            <p><img src="../cookbook/lena_flipped.png" /></p>
            
            <h2>Rotating An Image</h2>
            
            <p>Next, let's rotate an image. Two methods are provide, <a
            href="../classes/FreeImage/Transforms.html#method-i-rotate">FreeImage::Bitmap#rotate</a>
            and <a
            href="../classes/FreeImage/Transforms.html#method-i-rotate_ex">FreeImage::Bitmap#rotate_ex</a>.
            The rotate method is simpler to use:</p>
            
            <pre>image = FreeImage::Bitmap.open('images/lena.png', :png)&#x000A;# Rotate the image 45 degrees using white as the background fill color&#x000A;color = FreeImage::RGBQuad.create(255, 255, 255, 0)&#x000A;rotated = image.rotate(45, color)&#x000A;rotated.save(&quot;images/lena_rotate_45.png&quot;, :png)</pre>
            
            <p><img src="../cookbook/lena_rotate_45.png" /></p>
            
            <p>Note however that the image size and geometry has changed. Thus, the rotate
            function is best for rotating and image 90, 180 or 270 degrees.</p>
            
            <p>Let's now rotate the image using the rotate_ex method while using a mask:</p>
            
            <pre>rotated = image.rotate_ex(45, 0, 0, image.width/2, image.height/2, true)&#x000A;rotated.save(&quot;images/lena_rotate_ex_45_masked.png&quot;, :png)</pre>
            
            <p>And now let's rotate the image without a mask, so data is filled in using a
            mirroring algorithm:</p>
            
            <pre>rotated = image.rotate_ex(45, 0, 0, image.width/2, image.height/2, false)&#x000A;rotated.save(&quot;images/lena_rotate_ex_45_mirrored.png&quot;, :png)</pre>
            
            <p><img src="../cookbook/lena_rotate_ex_45_masked.png" /> <img
            src="../cookbook/lena_rotate_ex_45_mirrored.png" /></p>
            
            <p>Now lets rotate around the top left corner:</p>
            
            <pre>rotated = image.rotate_ex(45, 0, 0, 0, 0, true)&#x000A;rotated.save(&quot;images/lena_rotate_ex_45_top_left.png&quot;, :png)</pre>
            
            <p><img src="../cookbook/lena_rotate_ex_45_top_left.png" /></p>
            
            <h2>Compositing An Image</h2>
            
            <p>FreeImage also lets you composite an image with a background color or
            another image. Here is an example of compositing the sample image with
            green.</p>
            
            <pre>image = FreeImage::Bitmap.open('images/sample.png')&#x000A;color = FreeImage::RGBQuad.create(0, 255, 0, 0)&#x000A;composite =  image.composite_with_color(color)&#x000A;composite.save(&quot;images/sample_composite_color.png&quot;, :png)</pre>
            
            <p><img src="../cookbook/sample.png" /> <img
            src="../cookbook/sample_composite_color.png" /></p>
            
            <h2>Manipulating An Image</h2>
            
            <p>FreeImage also allows you to directly access each pixel in an image. Say
            for example we want to create an image that has a gradient from blue in the
            top left corner to green in the bottom right</p>
            
            <pre>image = FreeImage::Bitmap.create(300, 300, 24)&#x000A;color = FreeImage::RGBQuad.new&#x000A;image.width.times do |x|&#x000A;  image.height.times do |y|&#x000A;    color[:green] = (x.to_f/image.width) * 255&#x000A;    color[:blue] =  (y.to_f/image.height) * 255&#x000A;    image.set_pixel_color(x, y, color)&#x000A;  end&#x000A;end&#x000A;&#x000A;image.save('images/gradient.png', :png)</pre>
            
            <p><img src="../cookbook/gradient.png" /></p>
            
            <p>Note you can use a similar technique as another way of drawing a border
            around a thumbnail.</p>
            
            <h2>Using Scanlines</h2>
            
            <p><a href="../classes/FreeImage/Scanline.html">Scanlines</a> provide low
            level access to image data.   The only lower-level access is working with
            the actual raw bytes, which you can do via the FreeeImage::Bitmap#bytes
            method, but its not recommended.</p>
            
            <p>A scanline represents one row of image data, starting from the bottom. 
            Let's go back to our example above of drawing a red border around a
            thumbnail.</p>
            
            <pre># Helper method&#x000A;def set_to_red(color)&#x000A;  color[:red] = 255&#x000A;  color[:green] = 0&#x000A;  color[:blue] = 0&#x000A;end&#x000A;# Create a thumbnail&#x000A;image = FreeImage::Bitmap.open('images/lena.png')&#x000A;thumbnail = image.make_thumbnail(100)&#x000A;&#x000A;# Draw bottom border&#x000A;(0..3).each do |index|&#x000A;  scanline = thumbnail.scanline(index)&#x000A;  scanline.each do |color|&#x000A;    set_to_red(color)&#x000A;  end&#x000A;end&#x000A;&#x000A;# Draw top border&#x000A;((thumbnail.height - 5)..(thumbnail.height - 1)).each do |index|&#x000A;  scanline = thumbnail.scanline(index)&#x000A;  scanline.each do |color|&#x000A;    set_to_red(color)&#x000A;  end&#x000A;end&#x000A;&#x000A;# Draw left and right borders&#x000A;(1..(thumbnail.height - 2)).each do |index|&#x000A;  scanline = thumbnail.scanline(index)&#x000A;  (0..4).each do |index|&#x000A;    set_to_red(scanline[index])&#x000A;  end&#x000A;&#x000A;  ((thumbnail.width - 5)..(thumbnail.width - 1)).each do |index|&#x000A;    set_to_red(scanline[index])&#x000A;  end&#x000A;end&#x000A;&#x000A;thumbnail.save(&quot;images/lena_thumbnail_border_scanline.png&quot;, :png)</pre>
            
            <p><img src="../cookbook/lena_thumbnail_border_scanline.png" /></p>
          </div>
          <div id='context'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
